<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TOSEE — Notícias</title>
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png">
<style>
  :root{
    --bg:#0b0f12; --panel:#111418; --muted:#9aa0a6; --accent:#00e0ff;
    --card-shadow: 0 10px 30px rgba(0,0,0,0.6);
    --impact-high:#d9534f; --impact-mid:#f0ad4e; --impact-low:#6c6c6c;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:#e8f6fb}
  header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid rgba(255,255,255,0.02)}
  .brand{font-weight:800;color:var(--accent);letter-spacing:0.6px}
  nav{display:flex;gap:10px}
  nav a{color:var(--muted);padding:8px 10px;border-radius:8px;text-decoration:none}
  nav a.active{color:#001;background:var(--accent)}
  .tools{display:flex;gap:8px;align-items:center}
  input,select,textarea{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:8px;color:inherit}
  .btn{background:var(--accent);color:#001;padding:8px 12px;border-radius:8px;font-weight:700;cursor:pointer}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);padding:8px;border-radius:8px}
  main{display:flex;gap:18px;padding:18px}
  .left{flex:1}
  .right{width:320px}
  .card{background:var(--panel);padding:12px;border-radius:10px;box-shadow:var(--card-shadow);margin-bottom:12px}
  .card-title{font-weight:700;color:var(--muted);margin-bottom:8px}
  .news-list{display:flex;flex-direction:column;gap:12px}
  .news-item{display:flex;gap:12px;align-items:flex-start;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.02)}
  .thumb{width:96px;height:64px;background:#0d1113;border-radius:6px;flex-shrink:0;object-fit:cover}
  .news-body{flex:1}
  .news-title{color:var(--accent);font-weight:700;margin-bottom:6px}
  .news-meta{color:var(--muted);font-size:13px}
  .muted{color:var(--muted)}
  .form-row{display:flex;gap:8px;margin-bottom:8px}
  .small{font-size:13px;color:var(--muted)}
  .impact-pill{display:inline-block;padding:4px 8px;border-radius:999px;font-weight:700;font-size:12px}
  .impact-high{background:var(--impact-high);color:#fff}
  .impact-mid{background:var(--impact-mid);color:#08110b}
  .impact-low{background:var(--impact-low);color:#fff}
  .controls{display:flex;gap:8px;align-items:center}
  footer{padding:12px;text-align:center;color:var(--muted)}
  /* modal */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.65);z-index:9999}
  .modal .panel{background:var(--panel);padding:14px;border-radius:10px;min-width:320px;max-width:900px}
  @media(max-width:980px){
    main{flex-direction:column;padding:12px}
    .right{width:100%}
    .thumb{display:none}
  }
</style>
</head>
<body>
<header>
  <div style="display:flex;gap:18px;align-items:center">
    <div class="brand">TOSEE</div>
    <nav>
      <a href="index.html" class="active">Notícias</a>
      <a href="calendar.html">Calendário</a>
    </nav>
  </div>

  <div class="tools">
    <input id="q" placeholder="Pesquisar (ex: EURUSD, FOMC)" style="width:260px">
    <button id="btnFind" class="btn-ghost">Buscar</button>
    <button id="btnNew" class="btn">+ Nova notícia</button>
  </div>
</header>

<main>
  <section class="left">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="card-title">Feed de notícias</div>
          <div class="small" id="lastUpdated">Última atualização: —</div>
        </div>
        <div class="muted small" id="status">Status: idle</div>
      </div>
    </div>

    <div id="newsList" class="news-list card" style="padding:14px"></div>

    <div style="display:flex;justify-content:flex-end;margin-top:8px">
      <button id="btnRefresh" class="btn-ghost">Atualizar</button>
    </div>
  </section>

  <aside class="right">
    <div class="card">
      <div class="card-title">Resumo rápido</div>
      <div class="small">Principais pares:</div>
      <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
        <div class="muted">EURUSD — <strong id="p-eurusd">—</strong></div>
        <div class="muted">GBPUSD — <strong id="p-gbpusd">—</strong></div>
        <div class="muted">USDJPY — <strong id="p-usdjpy">—</strong></div>
        <div class="muted">XAUUSD — <strong id="p-xauusd">—</strong></div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">Eventos recentes</div>
      <ul id="recentList" style="padding-left:16px;margin:0" class="muted"></ul>
    </div>
  </aside>
</main>

<!-- modal add/edit -->
<div class="modal" id="modal">
  <div class="panel">
    <h3 id="mTitle">Adicionar notícia / evento</h3>
    <div style="margin-top:8px">
      <div class="form-row">
        <input id="fTitle" placeholder="Título (obrigatório)" />
      </div>
      <div class="form-row">
        <input id="fSource" placeholder="Fonte (ex: Reuters)" />
        <input id="fLink" placeholder="URL (opcional)">
      </div>
      <div class="form-row">
        <input id="fDate" type="date">
        <select id="fImpact">
          <option value="high">Impacto: Alto</option>
          <option value="mid">Impacto: Médio</option>
          <option value="low">Impacto: Baixo</option>
        </select>
      </div>
      <div class="form-row">
        <textarea id="fSummary" placeholder="Resumo (opcional)" style="width:100%;min-height:80px"></textarea>
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
        <button id="mCancel" class="btn-ghost">Cancelar</button>
        <button id="mSave" class="btn">Salvar</button>
      </div>
    </div>
  </div>
</div>

<footer>
  <div class="small">TOSEE — exemplo funcional (local). Dados de teste — substitua pelo seu feed para produção.</div>
</footer>

<script>
/*
  index.html script:
  - mantém lista em localStorage (key "tosee_items")
  - adiciona/edita/filtra
  - publica mudanças no localStorage -> calendar.html escuta via 'storage' event
*/
(() => {
  const KEY = 'tosee_items';
  const $ = id=>document.getElementById(id);

  // helpers
  function load(){ return JSON.parse(localStorage.getItem(KEY) || '[]'); }
  function save(arr){ localStorage.setItem(KEY, JSON.stringify(arr)); }
  function nowISODate(){ const d=new Date(); return d.toISOString().slice(0,10); }
  function displayDate(d){ if(!d) return ''; return new Date(d).toLocaleDateString(); }

  // sample data seed (only if empty)
  if(!localStorage.getItem(KEY)){
    const seed = [
      { id:cryptoRandomId(), title:"EUR/USD: dados do CPI impulsionam volatilidade", source:"MarketPulse", link:"#", date: new Date().toISOString().slice(0,10), impact:"high", summary:"CPI mais forte do que o esperado."},
      { id:cryptoRandomId(), title:"XAUUSD sobe após incerteza no mercado", source:"Reuters", link:"#", date: new Date().toISOString().slice(0,10), impact:"mid", summary:"Ouro reage a fluxos de aversão a risco."}
    ];
    save(seed);
  }

  // UI refs
  const listElm = $('newsList');
  const recent = $('recentList');
  const lastUpdated = $('lastUpdated');
  const status = $('status');

  // modal refs
  const modal = $('modal'), mTitle=$('mTitle'), fTitle=$('fTitle'), fSource=$('fSource'), fLink=$('fLink'), fDate=$('fDate'), fImpact=$('fImpact'), fSummary=$('fSummary'), mSave=$('mSave'), mCancel=$('mCancel');

  // funcs
  function cryptoRandomId(){ return Math.random().toString(36).slice(2,9); }

  function renderList(items){
    listElm.innerHTML = '';
    if(!items.length){
      listElm.innerHTML = '<div class="card">Sem notícias</div>'; return;
    }
    // most recent first
    items.slice().reverse().forEach(it => {
      const li = document.createElement('div'); li.className='news-item';
      const thumb = document.createElement('div'); thumb.className='thumb'; thumb.style.backgroundImage = "linear-gradient(180deg, rgba(0,0,0,0.2), rgba(0,0,0,0.1))";
      const body = document.createElement('div'); body.className='news-body';
      const title = document.createElement('div'); title.className='news-title'; title.innerText = it.title;
      const meta = document.createElement('div'); meta.className='news-meta muted'; meta.innerText = `${it.source || '—'} • ${displayDate(it.date)} • Impacto: ${it.impact}`;
      const summary = document.createElement('div'); summary.style.marginTop='8px'; summary.style.color='var(--muted)'; summary.innerText = it.summary || '';
      const actions = document.createElement('div'); actions.style.marginTop='8px';
      const open = document.createElement('a'); open.href = it.link || '#'; open.target='_blank'; open.rel='noopener'; open.className='btn-ghost'; open.innerText='Abrir';
      const editBtn = document.createElement('button'); editBtn.className='btn-ghost'; editBtn.style.marginLeft='8px'; editBtn.innerText='Editar';
      const delBtn = document.createElement('button'); delBtn.className='btn-ghost'; delBtn.style.marginLeft='8px'; delBtn.innerText='Apagar';
      actions.appendChild(open); actions.appendChild(editBtn); actions.appendChild(delBtn);

      // impact pill
      const pill = document.createElement('span');
      pill.className = 'impact-pill ' + (it.impact==='high'?'impact-high':it.impact==='mid'?'impact-mid':'impact-low');
      pill.style.marginLeft='8px';
      pill.innerText = it.impact === 'high' ? 'Alto' : it.impact==='mid'? 'Médio' : 'Baixo';

      const header = document.createElement('div');
      header.style.display='flex'; header.style.justifyContent='space-between'; header.style.alignItems='center';
      const leftHead = document.createElement('div'); leftHead.appendChild(title); leftHead.appendChild(meta);
      header.appendChild(leftHead); header.appendChild(pill);

      body.appendChild(header); body.appendChild(summary); body.appendChild(actions);
      li.appendChild(thumb); li.appendChild(body);
      listElm.appendChild(li);

      // events
      editBtn.onclick = ()=> openModal(it);
      delBtn.onclick = ()=>{
        if(!confirm('Apagar esta notícia?')) return;
        const arr = load().filter(x=>x.id !== it.id);
        save(arr); broadcastChange(); renderAll();
      };
    });
  }

  function renderRecent(items){
    recent.innerHTML = '';
    const rev = items.slice().reverse().slice(0,6);
    rev.forEach(it => {
      const li = document.createElement('li'); li.style.marginBottom='6px';
      li.innerText = `${displayDate(it.date)} • ${it.title}`;
      recent.appendChild(li);
    });
  }

  function renderAll(){
    const items = load();
    renderList(items);
    renderRecent(items);
    lastUpdated.innerText = 'Última atualização: ' + new Date().toLocaleTimeString();
    status.innerText = 'ok';
  }

  // modal open (new or edit)
  function openModal(item){
    modal.style.display='flex';
    mTitle.innerText = item ? 'Editar notícia' : 'Adicionar notícia / evento';
    fTitle.value = item ? item.title : '';
    fSource.value = item ? item.source : '';
    fLink.value = item ? item.link : '';
    fDate.value = item ? (item.date || nowISODate()) : nowISODate();
    fImpact.value = item ? item.impact : 'high';
    fSummary.value = item ? item.summary : '';
    mSave.onclick = async ()=>{
      const title = fTitle.value.trim();
      if(!title) return alert('Título obrigatório');
      const payload = {
        id: item ? item.id : cryptoRandomId(),
        title,
        source: fSource.value.trim(),
        link: fLink.value.trim(),
        date: fDate.value,
        impact: fImpact.value,
        summary: fSummary.value.trim()
      };
      const arr = load();
      if(item){
        const idx = arr.findIndex(x=>x.id===item.id);
        if(idx>=0) arr[idx] = payload;
        else arr.push(payload);
      } else arr.push(payload);
      save(arr);
      modal.style.display='none';
      broadcastChange();
      renderAll();
    };
  }

  mCancel.onclick = ()=> modal.style.display='none';

  // quick add button
  $('btnNew').onclick = ()=> openModal(null);

  // search
  $('btnFind').onclick = ()=>{
    const q = $('q').value.trim().toLowerCase();
    const all = load();
    if(!q) return renderList(all);
    const filtered = all.filter(i => (i.title||'').toLowerCase().includes(q) || (i.summary||'').toLowerCase().includes(q) || (i.source||'').toLowerCase().includes(q));
    renderList(filtered);
  };

  // refresh / simulate fetching updates
  $('btnRefresh').onclick = ()=> { renderAll(); };

  // storage broadcast helper (so calendar.html can update)
  function broadcastChange(){
    // write a small timestamped key to force storage event in other tabs
    localStorage.setItem('tosee_items_updated_at', new Date().toISOString());
  }

  // listen to storage changes (in case user edits in another tab)
  window.addEventListener('storage', (ev) => {
    if(ev.key === 'tosee_items' || ev.key === 'tosee_items_updated_at'){
      renderAll();
    }
  });

  // init
  renderAll();

})();
</script>
</body>
</html>
